(self.webpackChunk_internetarchive_bookreader=self.webpackChunk_internetarchive_bookreader||[]).push([[529],{7184:function(e,t,n){"use strict";var a;n(2222),n(7327),n(9826),n(4553),n(9600),jQuery.extend(BookReader.defaultOptions,{olHost:"https://openlibrary.org",enableChaptersPlugin:!0,bookId:""}),BookReader.prototype.setup=(a=BookReader.prototype.setup,function(e){a.call(this,e),this.olHost=e.olHost,this.enableChaptersPlugin=e.enableChaptersPlugin,this.bookId=e.bookId}),BookReader.prototype.init=function(e){return function(){var t=this;e.call(this),this.enableChaptersPlugin&&"embed"!==this.ui&&this.getOpenLibraryRecord(),this.enableMobileNav&&(this.bind(BookReader.eventNames.mobileNavOpen,(function(){t.updateTOCState(t.firstIndex,t._tocEntries),$("table-contents-list").parent().hasClass("mm-opened")&&t.updateTOCState(t.firstIndex,t._tocEntries)})),$(".BRmobileMenu__tableContents").click((function(){t.updateTOCState(t.firstIndex,t._tocEntries)})))}}(BookReader.prototype.init),BookReader.prototype.addChapter=function(e,t,n){var a=this,o=BookReader.util.cssPercentage(n,this.getNumLeafs()-1),r=function(e){a.jumpToIndex($(e.delegateTarget).data("pageIndex")),$(".current-chapter").removeClass("current-chapter"),$(e.delegateTarget).addClass("current-chapter")},i="".concat(e," | "),s="".concat("Page"," ").concat(t),l=$("<li></li>").append($("<span class='BRTOCElementTitle'></span>").text(i)).append($("<span class='BRTOCElementPage'></span>").text(s));l.addClass("BRtable-contents-el").appendTo(this.$(".table-contents-list")).data({pageIndex:n}),null!=n&&($("<div></div>").append($("<div />").text(i+s)).addClass("BRchapter").css({left:o}).appendTo(this.$(".BRnavline")).data({pageIndex:n}).hover((function(e){var t=e.currentTarget,n=t.querySelector("div"),o=n.getBoundingClientRect(),r=t.getBoundingClientRect(),i=2*parseInt(getComputedStyle(n).paddingLeft);o.x-i<0&&n.style.setProperty("transform","translateX(-".concat(r.left-i,"px)")),a.$(".BRsearch,.BRchapter").removeClass("front"),$(e.target).addClass("front")}),(function(e){return $(e.target).removeClass("front")})).on("click",r),l.bind("click",r).addClass("chapter-clickable").attr("data-event-click-tracking","BRTOCPanel|GoToChapter"))},BookReader.prototype.removeChapters=function(){this.$(".BRnavpos .BRchapter").remove()},BookReader.prototype.updateTOC=function(e){this.removeChapters(),this.enableMobileNav&&e.length>0&&this.$(".BRmobileMenu__tableContents").show();for(var t=0;t<e.length;t++)this.addChapterFromEntry(e[t]);this._tocEntries=e,$(".table-contents-list").children().each((function(t,n){e[t].mobileHTML=n}))},BookReader.prototype.addChapterFromEntry=function(e){e.pageIndex=this.getPageIndex(e.pagenum);var t=[e.label,e.title].filter((function(e){return e})).join(" ");this.addChapter(t,e.pagenum,e.pageIndex),this.$(".BRchapter, .BRsearch").each((function(e,t){var n=$(t);n.hover((function(){return n.addClass("front")}),(function(){return n.removeClass("front")}))}))},BookReader.prototype.getOpenLibraryRecord=function(){var e=this,t="".concat(this.olHost,"/query.json?type=/type/edition&*="),n="".concat(t,"&ocaid=").concat(this.bookId);$.ajax({url:n,dataType:"jsonp"}).then((function(n){return n&&n.length>0?n:$.ajax({url:"".concat(t,"&source_records=ia:").concat(e.bookId),dataType:"jsonp"})})).then((function(t){var n;t&&t.length>0&&(n=t[0])&&n.table_of_contents&&e.updateTOC(n.table_of_contents)}))},BookReader.prototype.buildMobileDrawerElement=function(e){return function(){var t=e.call(this);return this.enableMobileNav&&this.options.enableChaptersPlugin&&t.find(".BRmobileMenu__moreInfoRow").after($('\n        <li class="BRmobileMenu__tableContents" data-event-click-tracking="BRSidebar|TOCPanel">\n            <span>\n                <span class="DrawerIconWrapper">\n                  <img class="DrawerIcon" src="'.concat(this.imagesBaseURL,'icon_toc.svg" alt="toc-icon"/>\n                </span>\n                Table of Contents\n            </span>\n            <div>\n                <ol class="table-contents-list">\n                </ol>\n            </div>\n        </li>')).hide()),t}}(BookReader.prototype.buildMobileDrawerElement),BookReader.prototype.updateTOCState=function(e,t){if(t){$(".current-chapter").removeClass("current-chapter");var n=t.filter((function(e){return null!=e.pageIndex})).reverse(),a=n[n.findIndex((function(t){return t.pageIndex<=e}))];null!=a&&$(a.mobileHTML).addClass("current-chapter")}}}},0,[[7184,898]]]);
//# sourceMappingURL=plugin.chapters.js.map